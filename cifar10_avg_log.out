/Users/alice/opt/anaconda3/lib/python3.8/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: 'dlopen(/Users/alice/opt/anaconda3/lib/python3.8/site-packages/torchvision/image.so, 6): Library not loaded: @rpath/libpng16.16.dylib
  Referenced from: /Users/alice/opt/anaconda3/lib/python3.8/site-packages/torchvision/image.so
  Reason: Incompatible library version: image.so requires version 56.0.0 or later, but libpng16.16.dylib provides version 54.0.0'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/Users/alice/Desktop/python/PFL/system /Users/alice/Desktop/python/PFL
/Users/alice/Desktop/python/PFL/system /Users/alice/Desktop/python/PFL
2023-06-09 20:59:36.239122: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/Users/alice/Desktop/python/PFL/system /Users/alice/Desktop/python/PFL

cuda is not avaiable.

==================================================
Algorithm: FedAvg
Local batch size: 10
Local steps: 1
Local learing rate: 0.005
Local learing rate decay: False
Total number of clients: 20
Clients join in each round: 0.5
Clients randomly join: False
Client drop rate: 0.0
Client select regarding time: False
Running times: 1
Dataset: Cifar100
Number of classes: 10
Backbone: cnn
Using device: cpu
Using DP: False
Auto break: False
Global rounds: 1
DLG attack: False
Total number of new clients: 0
Fine tuning epoches on new clients: 0
==================================================

============= Running time: 0th =============
Creating server and clients ...
FedAvgCNN(
  (conv1): Sequential(
    (0): Conv2d(3, 32, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (conv2): Sequential(
    (0): Conv2d(32, 64, kernel_size=(5, 5), stride=(1, 1))
    (1): ReLU(inplace=True)
    (2): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
  )
  (fc1): Sequential(
    (0): Linear(in_features=1600, out_features=512, bias=True)
    (1): ReLU(inplace=True)
  )
  (fc): Linear(in_features=512, out_features=10, bias=True)
)
INFO:------------------------args.algorithm is:FedAvg-----------------------
**************************1.INfo,set_clients ,init data********************
client base client  0, total_num is 3020,label is [0, 1, 368, 0, 0, 0, 19, 0, 0, 19, 36, 9, 221, 41, 0, 0, 0, 402, 0, 11, 52, 71, 0, 87, 98, 0, 0, 13, 19, 0, 0, 2, 5, 7, 244, 0, 0, 345, 308, 0, 0, 0, 5, 0, 0, 77, 142, 0, 1, 0, 20, 6, 1, 0, 12, 0, 0, 1, 0, 0, 64, 0, 0, 0, 313, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
client base client  1, total_num is 3053,label is [0, 3, 0, 0, 10, 138, 0, 1, 3, 0, 1, 79, 3, 0, 148, 0, 0, 107, 3, 8, 15, 162, 2, 86, 0, 181, 0, 6, 22, 0, 2, 1, 0, 2, 58, 0, 3, 42, 0, 33, 0, 0, 0, 567, 1, 0, 2, 0, 5, 4, 1, 0, 4, 34, 0, 0, 143, 309, 2, 45, 0, 0, 169, 119, 0, 8, 0, 59, 0, 0, 12, 12, 0, 1, 0, 0, 0, 0, 0, 0, 319, 0, 0, 118, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
client base client  2, total_num is 2753,label is [8, 10, 0, 0, 189, 5, 0, 2, 0, 1, 0, 5, 0, 0, 0, 1, 0, 0, 78, 0, 118, 0, 9, 3, 1, 12, 0, 7, 0, 0, 3, 77, 0, 0, 110, 14, 3, 10, 0, 2, 0, 12, 11, 2, 0, 110, 0, 0, 13, 0, 0, 73, 454, 37, 3, 0, 217, 0, 3, 0, 0, 32, 0, 14, 12, 1, 30, 92, 113, 0, 20, 50, 0, 0, 0, 0, 74, 0, 7, 1, 0, 3, 0, 0, 0, 0, 0, 184, 92, 0, 5, 6, 2, 0, 397, 12, 0, 3, 0, 0]
client base client  3, total_num is 3029,label is [8, 258, 139, 0, 170, 0, 7, 1, 143, 3, 0, 7, 221, 1, 0, 0, 16, 0, 12, 0, 8, 87, 0, 0, 1, 11, 0, 121, 0, 1, 0, 27, 0, 0, 3, 121, 0, 0, 0, 0, 0, 0, 47, 1, 0, 0, 26, 0, 5, 0, 12, 1, 4, 0, 46, 0, 1, 0, 0, 3, 0, 0, 0, 268, 2, 0, 0, 16, 55, 525, 0, 24, 0, 5, 0, 0, 124, 83, 14, 22, 6, 144, 0, 5, 0, 224, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
client base client  4, total_num is 2640,label is [0, 31, 0, 0, 27, 57, 0, 4, 10, 0, 211, 0, 8, 0, 99, 3, 1, 6, 0, 36, 0, 0, 6, 5, 0, 0, 238, 0, 0, 26, 0, 3, 44, 0, 2, 1, 0, 49, 0, 134, 8, 14, 0, 1, 1, 0, 0, 23, 0, 0, 167, 24, 0, 21, 114, 14, 127, 26, 0, 0, 1, 9, 107, 0, 13, 43, 0, 181, 123, 2, 220, 0, 83, 15, 3, 0, 0, 8, 24, 0, 50, 27, 0, 7, 61, 0, 0, 94, 0, 0, 0, 0, 9, 1, 3, 15, 0, 0, 0, 0]
client base client  5, total_num is 2877,label is [1, 1, 0, 0, 59, 1, 1, 0, 0, 0, 0, 111, 0, 0, 0, 0, 241, 0, 0, 94, 0, 0, 27, 0, 0, 21, 0, 222, 20, 0, 0, 224, 2, 59, 1, 0, 0, 4, 0, 23, 0, 102, 0, 0, 0, 0, 0, 0, 1, 43, 31, 0, 8, 0, 53, 63, 6, 1, 0, 178, 0, 1, 0, 0, 0, 0, 0, 220, 0, 0, 188, 0, 0, 2, 0, 0, 0, 0, 0, 115, 7, 20, 69, 0, 0, 0, 19, 0, 0, 11, 71, 183, 0, 0, 60, 0, 0, 0, 313, 0]
client base client  6, total_num is 3120,label is [0, 0, 0, 168, 0, 0, 0, 85, 0, 0, 132, 268, 12, 10, 8, 0, 0, 0, 0, 0, 0, 162, 105, 0, 0, 194, 1, 105, 47, 8, 0, 0, 0, 0, 63, 0, 4, 1, 29, 0, 1, 0, 0, 4, 0, 14, 23, 0, 0, 7, 1, 0, 0, 0, 6, 0, 0, 13, 27, 40, 303, 60, 151, 0, 2, 1, 0, 8, 1, 0, 3, 234, 52, 0, 0, 0, 11, 258, 498, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
client base client  7, total_num is 3047,label is [0, 0, 7, 187, 0, 0, 65, 0, 419, 0, 64, 0, 111, 12, 2, 3, 0, 0, 0, 354, 0, 9, 0, 216, 259, 0, 0, 1, 3, 64, 0, 38, 354, 0, 0, 116, 22, 0, 0, 3, 0, 0, 0, 2, 336, 314, 1, 0, 1, 0, 0, 0, 0, 3, 0, 2, 3, 0, 0, 0, 0, 0, 0, 0, 1, 3, 72, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
client base client  8, total_num is 2807,label is [0, 1, 0, 0, 0, 0, 0, 22, 0, 7, 0, 0, 0, 434, 0, 0, 111, 0, 0, 0, 0, 0, 2, 31, 0, 122, 0, 0, 0, 18, 0, 48, 0, 14, 0, 0, 7, 1, 5, 4, 0, 0, 0, 2, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 8, 414, 0, 0, 0, 0, 0, 3, 0, 1, 0, 2, 75, 0, 3, 1, 0, 0, 0, 0, 348, 129, 136, 17, 0, 0, 10, 318, 108, 0, 0, 0, 1, 0, 0, 0, 0, 0, 2, 0, 7, 301, 91, 1, 0, 0]
client base client  9, total_num is 3211,label is [0, 292, 0, 0, 0, 0, 1, 103, 0, 15, 0, 99, 0, 0, 2, 0, 0, 65, 6, 0, 0, 15, 1, 0, 0, 0, 0, 13, 11, 192, 0, 0, 0, 0, 68, 16, 94, 0, 0, 162, 94, 0, 0, 1, 8, 2, 262, 106, 0, 0, 354, 5, 16, 25, 0, 0, 61, 37, 2, 4, 109, 0, 153, 73, 2, 0, 0, 0, 9, 5, 0, 1, 0, 160, 131, 19, 0, 0, 0, 1, 0, 3, 0, 130, 0, 0, 27, 256, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
client base client  10, total_num is 2761,label is [0, 0, 8, 0, 2, 0, 0, 0, 0, 0, 2, 0, 13, 28, 0, 47, 35, 0, 274, 2, 1, 0, 0, 12, 1, 1, 3, 0, 6, 9, 3, 0, 0, 0, 0, 0, 0, 0, 247, 6, 0, 52, 7, 13, 0, 40, 0, 24, 5, 0, 0, 0, 13, 1, 13, 0, 0, 0, 0, 0, 0, 0, 1, 108, 52, 0, 169, 0, 4, 0, 0, 0, 1, 201, 0, 0, 0, 212, 0, 0, 0, 0, 308, 0, 43, 47, 1, 0, 1, 461, 0, 17, 0, 1, 0, 0, 0, 60, 60, 146]
client base client  11, total_num is 3359,label is [54, 0, 0, 2, 134, 0, 29, 0, 0, 0, 4, 2, 0, 6, 303, 42, 6, 0, 0, 17, 30, 0, 0, 0, 38, 0, 0, 0, 1, 76, 0, 86, 0, 0, 0, 0, 0, 0, 0, 0, 200, 0, 9, 5, 31, 18, 0, 164, 0, 329, 0, 128, 0, 305, 10, 0, 0, 7, 88, 70, 0, 0, 1, 0, 0, 0, 2, 1, 0, 2, 110, 0, 0, 65, 0, 38, 4, 0, 1, 254, 0, 0, 0, 0, 17, 1, 1, 53, 0, 122, 0, 36, 63, 394, 0, 0, 0, 0, 0, 0]
client base client  12, total_num is 3290,label is [0, 0, 0, 111, 0, 11, 0, 0, 0, 155, 1, 19, 0, 0, 0, 0, 189, 14, 0, 4, 0, 0, 10, 3, 44, 0, 7, 0, 139, 0, 0, 0, 9, 0, 0, 0, 138, 6, 0, 102, 0, 0, 18, 0, 0, 0, 0, 0, 0, 1, 0, 340, 0, 0, 182, 62, 0, 1, 0, 97, 2, 0, 8, 0, 0, 0, 0, 0, 56, 0, 0, 141, 2, 0, 0, 0, 0, 0, 0, 1, 0, 0, 4, 0, 1, 0, 154, 2, 20, 0, 2, 0, 6, 203, 0, 0, 508, 64, 0, 453]
client base client  13, total_num is 2971,label is [2, 1, 1, 95, 2, 0, 0, 70, 0, 0, 0, 0, 0, 0, 0, 354, 0, 0, 2, 6, 0, 49, 0, 0, 0, 2, 6, 0, 1, 0, 0, 86, 61, 0, 49, 0, 0, 4, 0, 1, 169, 0, 0, 0, 60, 20, 126, 12, 8, 107, 0, 2, 1, 4, 0, 21, 0, 34, 0, 0, 0, 441, 0, 0, 0, 0, 9, 0, 0, 1, 0, 18, 0, 0, 90, 7, 0, 1, 0, 0, 0, 0, 0, 0, 120, 3, 0, 4, 0, 0, 0, 300, 0, 0, 0, 246, 0, 288, 87, 0]
client base client  14, total_num is 3301,label is [501, 0, 13, 4, 0, 108, 36, 293, 0, 325, 0, 0, 0, 65, 1, 1, 0, 0, 0, 0, 178, 0, 104, 0, 0, 0, 4, 0, 0, 0, 0, 0, 1, 8, 0, 91, 0, 0, 0, 0, 46, 0, 0, 0, 52, 0, 0, 0, 0, 60, 1, 0, 0, 8, 0, 0, 0, 0, 0, 3, 38, 41, 5, 0, 30, 285, 0, 20, 0, 43, 3, 117, 3, 0, 0, 0, 8, 0, 0, 136, 0, 45, 85, 1, 109, 0, 26, 0, 403, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
client base client  15, total_num is 3132,label is [7, 1, 11, 18, 3, 0, 1, 7, 0, 27, 1, 0, 0, 0, 0, 148, 0, 0, 0, 0, 182, 0, 326, 154, 10, 0, 226, 0, 0, 114, 433, 0, 52, 0, 1, 0, 323, 0, 0, 0, 0, 1, 0, 0, 0, 0, 16, 232, 17, 0, 0, 0, 0, 32, 0, 0, 1, 0, 77, 0, 0, 0, 0, 0, 0, 226, 1, 0, 0, 3, 0, 0, 167, 76, 1, 0, 1, 0, 0, 38, 1, 1, 0, 0, 0, 196, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
client base client  16, total_num is 3345,label is [0, 0, 21, 0, 0, 18, 292, 0, 20, 0, 98, 0, 3, 0, 0, 0, 0, 0, 224, 66, 1, 1, 0, 0, 0, 0, 0, 111, 122, 0, 0, 7, 71, 0, 0, 0, 0, 0, 0, 16, 1, 245, 13, 1, 82, 4, 0, 7, 543, 14, 0, 19, 1, 0, 0, 0, 0, 123, 0, 10, 59, 0, 4, 0, 3, 0, 0, 2, 0, 17, 2, 1, 291, 0, 0, 198, 0, 20, 0, 0, 13, 0, 7, 0, 203, 1, 0, 6, 0, 0, 0, 0, 384, 0, 0, 0, 0, 0, 0, 0]
client base client  17, total_num is 2642,label is [0, 0, 0, 0, 0, 0, 1, 0, 0, 23, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 43, 0, 0, 23, 9, 113, 0, 14, 0, 144, 0, 0, 56, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 27, 0, 1, 0, 0, 29, 11, 1, 97, 0, 152, 22, 29, 5, 399, 0, 0, 0, 0, 1, 164, 0, 238, 0, 111, 0, 41, 1, 0, 0, 6, 32, 0, 0, 54, 0, 0, 0, 3, 323, 2, 0, 105, 0, 44, 0, 0, 0, 133, 0, 1, 0, 0, 183, 0, 0]
client base client  18, total_num is 3035,label is [18, 0, 0, 3, 3, 0, 146, 0, 0, 17, 49, 0, 0, 2, 36, 0, 0, 5, 0, 0, 14, 0, 7, 0, 4, 0, 1, 0, 107, 0, 14, 0, 0, 453, 0, 1, 0, 67, 10, 113, 80, 0, 489, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 11, 37, 0, 149, 23, 1, 0, 3, 0, 14, 3, 0, 0, 0, 0, 0, 0, 74, 20, 0, 227, 0, 1, 29, 193, 0, 15, 0, 21, 1, 7, 0, 39, 5, 521, 0, 0, 0, 0, 0, 0, 0, 0, 0]
client base client  19, total_num is 2607,label is [1, 1, 32, 12, 1, 262, 2, 12, 5, 8, 1, 1, 8, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 121, 47, 1, 1, 88, 92, 1, 1, 1, 1, 1, 240, 6, 71, 1, 1, 1, 174, 1, 1, 0, 1, 1, 32, 1, 6, 1, 1, 1, 130, 1, 1, 1, 6, 2, 1, 1, 12, 1, 13, 6, 17, 1, 1, 125, 1, 1, 1, 1, 1, 1, 177, 15, 1, 1, 3, 1, 39, 1, 16, 23, 127, 259, 1, 1, 1, 1, 58, 1, 1, 132, 26, 1, 1, 140, 1]

Join ratio / total clients: 0.5 / 20
Finished creating server and clients.
-------------------------------------------------------------------------write exe canshu,txt path is /Users/alice/Desktop/python/PFL//res/FedAvg/Cifar100_canshu.csv

-------------Round number: 0---Evaluate global model----------
Traceback (most recent call last):
  File "/Users/alice/Desktop/python/PFL/system/main.py", line 477, in <module>
    run(args)
  File "/Users/alice/Desktop/python/PFL/system/main.py", line 296, in run
    server.train()
  File "/Users/alice/Desktop/python/PFL/system/flcore/servers/serveravg.py", line 62, in train
    res = self.evaluate(i)
  File "/Users/alice/Desktop/python/PFL/system/flcore/servers/serverbase.py", line 312, in evaluate
    stats_train = self.train_metrics()
  File "/Users/alice/Desktop/python/PFL/system/flcore/servers/serverbase.py", line 301, in train_metrics
    cl, ns = c.train_metrics()
  File "/Users/alice/Desktop/python/PFL/system/flcore/clients/clientbase.py", line 190, in train_metrics
    loss = self.loss(output, y)
  File "/Users/alice/opt/anaconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/Users/alice/opt/anaconda3/lib/python3.8/site-packages/torch/nn/modules/loss.py", line 1174, in forward
    return F.cross_entropy(input, target, weight=self.weight,
  File "/Users/alice/opt/anaconda3/lib/python3.8/site-packages/torch/nn/functional.py", line 3029, in cross_entropy
    return torch._C._nn.cross_entropy_loss(input, target, weight, _Reduction.get_enum(reduction), ignore_index, label_smoothing)
IndexError: Target 12 is out of bounds.
